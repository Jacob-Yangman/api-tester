# OpenAI API æµ‹è¯•å·¥å…·ç®±

ä¸€ä¸ªæ”¯æŒ **å¯è§†åŒ–ç•Œé¢** å’Œ **å‘½ä»¤è¡Œå¿«é€Ÿæµ‹è¯•** çš„ OpenAI åè®® API æµ‹è¯•å·¥å…·ï¼Œé€‚åˆåšå›ºå®šæ—¶é•¿çš„æŒç»­è´Ÿè½½å‹æµ‹ä¸å¹¶å‘èƒ½åŠ›è¯„ä¼°ã€‚

## ğŸ“¦ å®‰è£…

```bash
pip install -r requirements.txt
```

å¯é€‰ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
python -m venv .venv
.venv\\Scripts\\activate  # Windows
# source .venv/bin/activate  # macOS/Linux
pip install -r requirements.txt
```

---

## ğŸ–¥ï¸ æ–¹å¼ä¸€ï¼šä½¿ç”¨ Streamlit å¯è§†åŒ–ç•Œé¢ï¼ˆæ¨èï¼‰

é€‚åˆï¼šè°ƒè¯•ã€æŸ¥çœ‹æ¨ç†å†…å®¹ã€å›¢é˜Ÿå…±äº«ã€‚

### å¯åŠ¨å‘½ä»¤

```bash
streamlit run app.py
```

### é…ç½®è¯´æ˜ï¼ˆç›´æ¥åœ¨ç•Œé¢å¡«å†™ï¼‰ï¼š

| å‚æ•° | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| Base URL | `https://api.deepseek.com/v1` | API åœ°å€ |
| API Key | `sk-xxxxxx` | ç›´æ¥è¾“å…¥ï¼Œä¸ä¿å­˜ |
| Model Name | `deepseek-r1` | æ¨¡å‹å |
| Timeout | `30` | è¶…æ—¶ç§’æ•° |
| å…¶ä»–å‚æ•° | â€” | å¯è°ƒæ•´æ¸©åº¦ã€max_tokens ç­‰ |

> ğŸ’¡ æ”¯æŒ **æµå¼è¾“å‡º**ã€**æ¨ç†å†…å®¹å±•ç¤º**ã€**å›ºå®šæ—¶é•¿å¹¶å‘å‹æµ‹**ã€**æŠ¥å‘Šå¯¼å‡º**

---

## âš¡ æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆæ— éœ€ç•Œé¢ï¼‰

é€‚åˆï¼šè‡ªåŠ¨åŒ–ã€CI/CDã€å¿«é€ŸéªŒè¯è¿é€šæ€§å’Œæœ€å¤§å¹¶å‘èƒ½åŠ›ã€‚

### ç¤ºä¾‹ 1ï¼šæµ‹è¯•è¿é€šæ€§

```bash
python cli_tester.py --base-url "https://api.deepseek.com/v1" --api-key "sk-xxxxxx" --model "deepseek-r1" --prompt "ä½ å¥½"
```

### ç¤ºä¾‹ 2ï¼šå‹æµ‹æœ€å¤§å¹¶å‘èƒ½åŠ›ï¼ˆæ‰¾å‡ºç“¶é¢ˆï¼‰

```bash
# é€æ­¥å¢åŠ å¹¶å‘ï¼Œæ‰¾åˆ°æˆåŠŸç‡ä¸‹é™ç‚¹
python cli_tester.py --base-url "http://localhost:11434/v1" --api-key "ollama" --model "qwen2.5" --total 100 --concurrency 20 --prompt "å†™ä¸€é¦–è¯—"
```

### ç¤ºä¾‹ 3ï¼šå›ºå®šæ—¶é•¿æŒç»­è´Ÿè½½æµ‹è¯•ï¼ˆæ¨èè¯„ä¼°ï¼‰

```bash
# æŒç»­æµ‹è¯•60ç§’ï¼Œè§‚å¯Ÿç³»ç»Ÿåœ¨æŒç»­è´Ÿè½½ä¸‹çš„è¡¨ç°
python cli_tester.py --base-url "https://api.deepseek.com/v1" --api-key "sk-xxxxxx" --model "deepseek-r1" --duration 60 --concurrency 10 --prompt "è¯·åˆ†æä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿"
```

### å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

- ç»ˆç«¯çœ‹ä¸åˆ°è¿›åº¦æ¡ï¼Ÿ
  - ä½¿ç”¨ CLI æ—¶ä¼šæ˜¾ç¤º tqdm è¿›åº¦æ¡ï¼›Web ç•Œé¢å†…æˆ‘ä»¬ä»¥æ–‡æœ¬æ–¹å¼æ›´æ–°å®æ—¶ä¿¡æ¯ï¼Œé¿å…é—ªçƒã€‚
- å¯¼å‡ºæŠ¥å‘Šåé¡µé¢å†…å®¹æ¶ˆå¤±ï¼Ÿ
  - å·²ä¿®å¤ï¼šå¯¼å‡ºåŒºåŸŸå·²ç§»è‡³ç»“æœå±•ç¤ºåŒºåŸŸä¹‹å¤–ï¼Œä¸‹è½½åä¸å†æ¸…ç©ºå†…å®¹ã€‚
- å›ºå®šæ—¶é•¿æµ‹è¯•æ²¡æœ‰å°½å¤´æ„Ÿï¼Ÿ
  - Web ç•Œé¢å®æ—¶æ˜¾ç¤º `elapsed/target, requests, success, qps` æ–‡æœ¬ï¼Œé¿å…ç„¦è™‘æ„Ÿã€‚

### å‚æ•°è¯´æ˜

| å‚æ•° | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--base-url` | âœ… | â€” | API åœ°å€ |
| `--api-key` | âœ… | â€” | API Key |
| `--model` | âœ… | â€” | æ¨¡å‹å |
| `--timeout` | âŒ | 30 | è¶…æ—¶ç§’æ•° |
| `--prompt` | âŒ | "ä½ å¥½..." | æµ‹è¯•é—®é¢˜ |
| `--total` | âŒ | 10 | æ€»è¯·æ±‚æ•°ï¼ˆä¸ --duration äº’æ–¥ï¼‰ |
| `--duration` | âŒ | â€” | å›ºå®šæ—¶é•¿æµ‹è¯•ï¼ˆç§’ï¼Œä¸ --total äº’æ–¥ï¼‰ |
| `--concurrency` | âŒ | 5 | å¹¶å‘æ•°ï¼ˆå»ºè®®ä» 5 å¼€å§‹é€æ­¥å¢åŠ ï¼‰ |
| `--temperature` | âŒ | 0.7 | æ¸©åº¦ |
| `--max-tokens` | âŒ | 4096 | æœ€å¤§è¾“å‡º token |

### å¹¶å‘å‹æµ‹æ¨èæµç¨‹ï¼ˆå›ºå®šæ—¶é•¿ä¼˜å…ˆï¼‰

1) åŸºçº¿æµ‹è¯•ï¼ˆå•çº¿ç¨‹æ€§èƒ½ï¼‰

```bash
python cli_tester.py --base-url xxx --api-key sk-xxx --model xxx \
  --concurrency 1 --duration 60 --prompt "hello"
```

2) é˜¶æ¢¯å¢å‹æµ‹è¯•ï¼ˆæŒç»­è´Ÿè½½ï¼‰

```bash
# å»ºè®®é˜¶æ¢¯ï¼š10 -> 20 -> 35 -> 50ï¼Œå¹¶ä¿æŒ 60~180 ç§’
python cli_tester.py --base-url xxx --api-key sk-xxx --model xxx --concurrency 10 --duration 120
python cli_tester.py --base-url xxx --api-key sk-xxx --model xxx --concurrency 20 --duration 120
# ... ç»§ç»­æå‡
```

3) è¯„ä¼°ä¸ç»“è®ºï¼ˆä¸‰ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼‰

- æˆåŠŸç‡ï¼šæ˜¯å¦ 100%ï¼ˆä¸ä¸º 100% åˆ™å¤±è´¥ï¼‰
- å»¶è¿Ÿï¼šP95 æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´ï¼ˆå¦‚ â‰¤ 15sï¼‰
- åå(QPS)ï¼šæ˜¯å¦éšå¹¶å‘æé«˜æ¥è¿‘çº¿æ€§å¢é•¿

å½“ `--concurrency 50 --duration 180` æ»¡è¶³ï¼š

- æˆåŠŸç‡ == 100%
- P95 < ç›®æ ‡å€¼ï¼ˆå¦‚ 15sï¼‰
- QPS ç›¸æ¯”åŸºçº¿æ˜æ˜¾æå‡

å³å¯è®¤ä¸ºè¯¥æ¨¡å‹åœ¨æ­¤é…ç½®ä¸‹å¯ç¨³å®šæ”¯æŒ 50 è·¯å¹¶å‘ã€‚

### æµ‹è¯•æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | å‚æ•° | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|------|----------|------|
| **å›ºå®šè¯·æ±‚æ•°** | `--total` | å¿«é€ŸéªŒè¯ã€æ‰¾å‡ºå¹¶å‘ä¸Šé™ | ç¬æ—¶å‹åŠ›ï¼Œå®¹æ˜“â€œå°–å³°â€ |
| **å›ºå®šæ—¶é•¿** | `--duration` | æŒç»­è´Ÿè½½ã€ç¨³å®šæ€§éªŒè¯ | æŒç»­å‹åŠ›ï¼Œæ›´æ¥è¿‘çœŸå®åœºæ™¯ï¼ˆæ¨èï¼‰ |

---

## ğŸ” å®‰å…¨æç¤º

- API Key ä»…åœ¨å†…å­˜ä¸­ä½¿ç”¨ï¼Œ**ä¸ä¼šå†™å…¥æ–‡ä»¶**

## ğŸ§© æ”¯æŒæ¨¡å‹

- GPT ç³»åˆ—
- DeepSeek-R1/V3
- Qwen
- Ollama
- æ‰€æœ‰å…¼å®¹ OpenAI åè®®çš„æ¨¡å‹

## ğŸš€ é€‚ç”¨åœºæ™¯

- æ¨¡å‹è¿é€šæ€§éªŒè¯
- å¹¶å‘èƒ½åŠ›å‹æµ‹ï¼ˆå›ºå®šè¯·æ±‚æ•° / å›ºå®šæ—¶é•¿ï¼‰
- æŒç»­è´Ÿè½½æµ‹è¯•ï¼ˆå›ºå®šæ—¶é•¿ï¼Œæ¨èï¼‰
- æ¨ç†æ¨¡å‹è°ƒè¯•
- å›¢é˜Ÿ API æµ‹è¯•æ ‡å‡†å·¥å…·
